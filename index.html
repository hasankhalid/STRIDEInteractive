<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="./resources/favicon.ico" type="image/x-icon" />
    <title>STRIDE</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:200,300,400,500,600" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.2/TweenMax.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>

    <script src="js/fullpage/fullpage.js"></script>
    <script src="js/fullpage/fullpage.extensions.min.js"></script>
    <link rel="stylesheet" href="js/fullpage/fullpage.css">
    <link rel="stylesheet" href="./index.css">
    <style type="text/css">

    </style>
  </head>

  <body>
    <div class="main-header">
      <div class="main-header__logo">
        STRIDE
      </div>
      <div class="main-header__counter">
        <div class="main-header__current-slide"> 
          1
        </div>
        <div class="main-header__sep"> 
        </div>
        <div class="main-header__total-slides">
          10 
        </div>
        <div class="main-header__circle">
          <svg class="main-header__svg">
            <g class="main-header__circle-g">
              <circle cx="0" cy="0" r="33px" stroke-width="2px"></circle>
              <circle cx="0" cy="0" r="28px" stroke-width="4px" id="progress-circle"></circle>
            </g>
          </svg>
        </div>
      </div>
    </div>
    <div id="fullpage">
      <div class="section">
        <div class="background background--slide-school">
          <div class="background__overlay background__overlay--black">
          </div>
        </div>
        <div class="content content--vertical content--white-text">
            <p class="logoPlaceholder">STRIDE</p>
            <p class="byIsap">a project of I-SAPS</p>
            <p class=" titleNote">addresses the alarmingly low student retention rates in Pakistan</p>
            <div class="titleSocial ">
              <img class="socialIcon" src="./resources/facebook-letter-logo.svg"/>
              <img class="socialIcon twitter" src="./resources/twitter.svg"/>
              <img class="socialIcon" src="./resources/link-symbol.svg"/>
            </div>
          </div>
      </div>
      <div class="section" data-name="circles">
        <div class="background background--slide-teacher">
          <div class="background__overlay background__overlay--blue">
          </div>
        </div>
        <div class="content content--default content--white-text">
              <p class="content__title">Proportion of Age Appropriate Children in Schools
            </p>
            <svg id="age-circle-diagram">
              <filter id="drop-shadow" height="130%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="10" result="blur" color-interpolation-filters="sRGB"></feGaussianBlur>
                <feOffset in="blur" result="offsetBlur" dy="10"></feOffset>
                <feFlood flood-color="#000" flood-opacity="0.2"></feFlood>
                <feComposite operator="in" in2="offsetBlur"></feComposite>
                <feMerge>
                  <feMergeNode></feMergeNode>
                  <feMergeNode in="SourceGraphic"></feMergeNode>
                </feMerge>
              </filter>
            </svg>
          </div>
      </div>
      <div class="section" data-name="barChart">
        <div class="background background--slide-teacher">
          <div class="background__overlay background__overlay--blue">
          </div>
        </div>
        <div class="content content--default content--white-text">
              <p class="content__title">Number of Schools
            </p>
            <svg id="num-schools-bar-chart">
            </svg>
          </div>
      </div>
      <div class="section">
        <div class="background background--slide-kids">
          <div class=" background__overlay background__overlay--grey">
          </div>
        </div>
        <div class="content content--default content--white-text">
          <p class="content__title"> 
            What are the reasons for low retention and transition rates?
          </p>
        </div>
      </div>
      <div class="section">
        <div class="background background--slide-cycle-girls">
          <div class="background__overlay background__overlay--grey">
          </div>
        </div>
        <div class="content content--default content--white-text">
          <div class="content__title-para-g">
            <p class="content__title">Lack of Transport</p>
            <p class="content__para">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus quis orci ligula.</p>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="background background--slide-blue">
        </div>
        <div class="content content--default content--white-text">
          <p class="content__title">Lack of Transport</p>
       </div>
      </div>
      <div class="section">
        <div class="background background--slide-benifits">
          <div class=" background__overlay background__overlay--grey">
          </div>
        </div>
        <div class="content content--default content--white-text">
          <p class="content__title"> 
            Benefits of the STRIDE Approach
          </p>
        </div>
      </div>
      <div class="section" data-name="animline">
        <div class="background background--slide-classroom">
          <div class="background__overlay background__overlay--blue">
          </div>
        </div>
        <div class="content content--default content--white-text">
          <div class="content__title-para-g">
            <p class="content__title">Cost Saving</p>
            <p class="content__para">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus quis orci ligula.</p>
          </div>
          <svg id="cost-line-diagram"></svg>
        </div>
      </div>
      <div class="section">
        <div class="background background--slide-classroom">
          <div class="background__overlay background__overlay--blue">
          </div>
        </div>
        <div class="content content--default content--white-text">
          <div class="content__title-para-g">
            <p class="content__title">Other Benefit</p>
            <p class="content__para">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus quis orci ligula.</p>
          </div>
        </div>
      </div>
    </div>
    <div>
    	<img class=" downIcon" src="./resources/down-chevron.svg"/>
    </div>
    <script type="text/javascript" src="./js/circle.js"></script>
    <script type="text/javascript" src="./js/line.js"></script>
    <script type="text/javascript" src="./js/bar.js"></script>
    <script>

      var sectionArr = Array.from(document.getElementsByClassName('section'));
      sectionArr.forEach((d,i)=>{
        d.setAttribute('data-index', i + 1);
      });

      initProgressCircle();

      var myFullpage = new fullpage('#fullpage', {
          verticalCentered: false,
          licenseKey : 'OPEN-SOURCE-GPLV3-LICENSE',

          afterLoad: function(origin, destination, direction){
						var loadedSection = this;

            //destination.style.animation 
						
						if(destination.item.dataset.name === 'circles'){
							makeAgeProportionCircle();
						}

						if(origin && origin.item.dataset.name === 'circles'){
							removeAgeProportionCircle();
						}

						if(destination.item.dataset.name === 'animline'){
							createLineChart();
						}

						if(origin && origin.item.dataset.name === 'animline'){
							removeLineChart();
						}	

            if(destination.item.dataset.name === 'barChart'){
              createBarChart();
            }

            if(origin && origin.item.dataset.name === 'barChart'){
              removeBarChart();
            } 					
					},

          onLeave : function(origin,destination,direction){
            //console.log(destination);

            var index = destination.item.dataset.index;
            document.getElementsByClassName('main-header__current-slide')[0].innerText = index;

            updateProgressCircle(index);
            /*testD = destination;
            origin.item.querySelector('.background').style.animation = '';
            destination.item.querySelector('.background').style.animation = 'zoom-in 0.7s ease 0s';*/
          }
      });

      function initProgressCircle(){
        var circle = document.getElementById('progress-circle');
        var circleLength = circle.getTotalLength();
        circle.setAttribute('stroke-dasharray', `${circleLength}, ${circleLength}`);
        circle.setAttribute('stroke-dashoffset', circleLength - ((1/sectionArr.length) * circleLength));
      }

      function updateProgressCircle(index){
        var circle = document.getElementById('progress-circle');
        var circleLength = circle.getTotalLength();

        var newOffset = circleLength - (((index)/sectionArr.length) * circleLength);
        circle.setAttribute('stroke-dashoffset', newOffset);
      }
    </script>
  </body>
</html>
